import cirq
import cirq_qubitization


def get_qubits(selection_length: int, target_length: int):
    buffer = cirq.LineQubit.range(2 * selection_length + target_length + 1)
    return (
        buffer[0],
        buffer[1 : 2 * selection_length : 2],
        buffer[2 : 2 * selection_length + 1 : 2],
        buffer[2 * selection_length + 1 :],
    )


def test_unary_iteration():
    control, selection, ancilla, target = get_qubits(4, 10)
    cop = cirq_qubitization.unary_iteration(
        control, selection, ancilla, cirq.X.on_each(*target)
    )
    cirq.testing.assert_has_diagram(
        cop.circuit,
        """
0: ────@───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────@─────────────────────────@───
       │                                                                                                                                       │                         │
1: ────(0)─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼─────────────────────────@───
       │                                                                                                                                       │                         │
2: ────X─────@───────────────────────────────────────────────────────────────@─────────────────────────────────────────────────────────────@───X───@─────────@───────@───X───
             │                                                               │                                                             │       │         │       │
3: ──────────(0)─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────@───────┼─────────┼───────┼───────
             │                                                               │                                                             │       │         │       │
4: ──────────X─────@───────────────────────────@─────────────────────────@───X───@───────────────────────────@─────────────────────────@───X───────┼─────────┼───────┼───────
                   │                           │                         │       │                           │                         │           │         │       │
5: ────────────────(0)─────────────────────────┼─────────────────────────@───────(0)─────────────────────────┼─────────────────────────@───────────┼─────────┼───────┼───────
                   │                           │                         │       │                           │                         │           │         │       │
6: ────────────────X─────@─────────@───────@───X───@─────────@───────@───X───────X─────@─────────@───────@───X───@─────────@───────@───X───────────┼─────────┼───────┼───────
                         │         │       │       │         │       │                 │         │       │       │         │       │               │         │       │
7: ──────────────────────(0)───────┼───────@───────(0)───────┼───────@─────────────────(0)───────┼───────@───────(0)───────┼───────@───────────────(0)───────┼───────@───────
                         │         │       │       │         │       │                 │         │       │       │         │       │               │         │       │
8: ──────────────────────X─────@───X───@───X───────X─────@───X───@───X─────────────────X─────@───X───@───X───────X─────@───X───@───X───────────────X─────@───X───@───X───────
                               │       │                 │       │                           │       │                 │       │                         │       │
9: ────────────────────────────X───────┼─────────────────┼───────┼───────────────────────────┼───────┼─────────────────┼───────┼─────────────────────────┼───────┼───────────
                                       │                 │       │                           │       │                 │       │                         │       │
10: ───────────────────────────────────X─────────────────┼───────┼───────────────────────────┼───────┼─────────────────┼───────┼─────────────────────────┼───────┼───────────
                                                         │       │                           │       │                 │       │                         │       │
11: ─────────────────────────────────────────────────────X───────┼───────────────────────────┼───────┼─────────────────┼───────┼─────────────────────────┼───────┼───────────
                                                                 │                           │       │                 │       │                         │       │
12: ─────────────────────────────────────────────────────────────X───────────────────────────┼───────┼─────────────────┼───────┼─────────────────────────┼───────┼───────────
                                                                                             │       │                 │       │                         │       │
13: ─────────────────────────────────────────────────────────────────────────────────────────X───────┼─────────────────┼───────┼─────────────────────────┼───────┼───────────
                                                                                                     │                 │       │                         │       │
14: ─────────────────────────────────────────────────────────────────────────────────────────────────X─────────────────┼───────┼─────────────────────────┼───────┼───────────
                                                                                                                       │       │                         │       │
15: ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────X───────┼─────────────────────────┼───────┼───────────
                                                                                                                               │                         │       │
16: ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────X─────────────────────────┼───────┼───────────
                                                                                                                                                         │       │
17: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────X───────┼───────────
                                                                                                                                                                 │
18: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────X───────────
""",
    )
